{"ast":null,"code":"import _regeneratorRuntime from\"/Users/angelinewang/SEI/Token-Based-Authenication-React-Express/token-based-auth/student/react-mastermind/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/angelinewang/SEI/Token-Based-Authenication-React-Express/token-based-auth/student/react-mastermind/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"/Users/angelinewang/SEI/Token-Based-Authenication-React-Express/token-based-auth/student/react-mastermind/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import React,{Component}from'react';import'./App.css';import{Route,Switch}from'react-router-dom';import GamePage from'../../pages/GamePage/GamePage';import SettingsPage from'../SettingsPage/SettingsPage';import HighScoresPage from'../HighScoresPage/HighScoresPage';import SignupPage from'../SignupPage/SignupPage';import LoginPage from'../LoginPage/LoginPage';import scoresService from'../../utils/scoresService';const colors={Easy:['#7CCCE5','#FDE47F','#E04644','#B576AD'],Moderate:['#7CCCE5','#FDE47F','#E04644','#B576AD','#B7D968'],Difficult:['#7CCCE5','#FDE47F','#E04644','#B576AD','#B7D968','#555E7B']};class App extends Component{constructor(){super();this.isHighScore=guessesCopy=>{let lastScore=this.state.scores[this.state.scores.length-1];return guessesCopy.length<lastScore.numGuesses||guessesCopy.length===lastScore.numGuesses&&this.state.elapsedTime<lastScore.seconds;};this.handleTimerUpdate=()=>{this.setState(curState=>({elapsedTime:++curState.elapsedTime}));};this.handleDifficultyChange=level=>{// Use callback to ensure level is updated BEFORE calling handleNewGameClick\nthis.setState({difficulty:level},()=>this.handleNewGameClick());};this.handleColorSelection=colorIdx=>{this.setState({selColorIdx:colorIdx});};this.handleNewGameClick=()=>{this.setState(this.getInitialState());};this.handlePegClick=pegIdx=>{// Get index of last guess object\nlet currentGuessIdx=this.state.guesses.length-1;// Always replace objects/arrays with NEW ones\nlet guessesCopy=[...this.state.guesses];let guessCopy=_objectSpread({},guessesCopy[currentGuessIdx]);let codeCopy=[...guessCopy.code];// Update the NEW code array with the currently selected color\ncodeCopy[pegIdx]=this.state.selColorIdx;// Update the NEW guess object\nguessCopy.code=codeCopy;// Update the NEW guesses array\nguessesCopy[currentGuessIdx]=guessCopy;// Update state with the NEW guesses array\nthis.setState({guesses:guessesCopy});};this.handleScoreClick=()=>{// Need the index of the current guess object (last object in guesses array)\nlet currentGuessIdx=this.state.guesses.length-1;// Create \"working\" copies of the \"guessed\" code and the secret\n// code so that we can modify them as we compute the number of\n// perfect and almost without messing up the actual ones in state\nlet guessCodeCopy=[...this.state.guesses[currentGuessIdx].code];let secretCodeCopy=[...this.state.code];let perfect=0,almost=0;// First pass computes number of \"perfect\"\nguessCodeCopy.forEach((code,idx)=>{if(secretCodeCopy[idx]===code){perfect++;// Ensure same choice is not matched again\n// by updating both elements in the \"working\"\n// arrays to null\nguessCodeCopy[idx]=secretCodeCopy[idx]=null;}});// Second pass computes number of \"almost\"\nguessCodeCopy.forEach((code,idx)=>{if(code===null)return;let foundIdx=secretCodeCopy.indexOf(code);if(foundIdx>-1){almost++;// Again, ensure same choice is not matched again\nsecretCodeCopy[foundIdx]=null;}});// State must only be updated with NEW objects/arrays\n// Always replace objects/arrays with NEW ones\nlet guessesCopy=[...this.state.guesses];let guessCopy=_objectSpread({},guessesCopy[currentGuessIdx]);let scoreCopy=_objectSpread({},guessCopy.score);scoreCopy.perfect=perfect;scoreCopy.almost=almost;guessCopy.score=scoreCopy;guessesCopy[currentGuessIdx]=guessCopy;if(perfect===4){// Chicken dinner - need to stop the timer!\nthis.setState(state=>({isTiming:false}),/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var initials;return _regeneratorRuntime.wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:if(!(this.state.scores.length<20||this.isHighScore(guessesCopy))){_context.next=5;break;}initials=prompt('Congrats you have a top-20 score! Enter your initials: ').substr(0,3);_context.next=4;return scoresService.create({initials,numGuesses:guessesCopy.length,seconds:this.state.elapsedTime});case 4:this.props.history.push('/high-scores');case 5:case\"end\":return _context.stop();}},_callee,this);})));}else{guessesCopy.push(this.getNewGuess());}this.setState({guesses:guessesCopy,// This is a great way to update isTiming\nisTiming:perfect!==4});};this.handleUpdateScores=scores=>{this.setState({scores});};this.state=_objectSpread(_objectSpread({},this.getInitialState()),{},{difficulty:'Easy',scores:[]});}getInitialState(){return{selColorIdx:0,guesses:[this.getNewGuess()],code:this.genCode(),elapsedTime:0,isTiming:true};}getNewGuess(){return{code:[null,null,null,null],score:{perfect:0,almost:0}};}genCode(){let numColors=this.state&&colors[this.state.difficulty].length;numColors=numColors||4;return new Array(4).fill().map(dummy=>Math.floor(Math.random()*numColors));}getWinTries(){// if winner, return num guesses, otherwise 0 (no winner)\nlet lastGuess=this.state.guesses.length-1;return this.state.guesses[lastGuess].score.perfect===4?lastGuess+1:0;}/*--- Lifecycle Methods ---*/componentDidMount(){var _this=this;return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var scores;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.next=2;return scoresService.index();case 2:scores=_context2.sent;_this.setState({scores});case 4:case\"end\":return _context2.stop();}},_callee2);}))();}render(){let winTries=this.getWinTries();return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"header\",{className:\"header-footer\"},\"R E A C T \\xA0\\xA0\\xA0  M A S T E R M I N D\"),/*#__PURE__*/React.createElement(Switch,null,/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/\",render:()=>/*#__PURE__*/React.createElement(GamePage,{winTries:winTries,colors:colors[this.state.difficulty],selColorIdx:this.state.selColorIdx,guesses:this.state.guesses,elapsedTime:this.state.elapsedTime,isTiming:this.state.isTiming,handleColorSelection:this.handleColorSelection,handleNewGameClick:this.handleNewGameClick,handlePegClick:this.handlePegClick,handleScoreClick:this.handleScoreClick,handleTimerUpdate:this.handleTimerUpdate})}),/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/settings\",render:props=>/*#__PURE__*/React.createElement(SettingsPage,Object.assign({},props,{colorsLookup:colors,difficulty:this.state.difficulty,handleDifficultyChange:this.handleDifficultyChange}))}),/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/signup\",render:({history})=>/*#__PURE__*/React.createElement(SignupPage,{history:history})}),/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/login\",render:()=>/*#__PURE__*/React.createElement(LoginPage,null)}),/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/high-scores\",render:()=>/*#__PURE__*/React.createElement(HighScoresPage,{scores:this.state.scores,handleUpdateScores:this.handleUpdateScores})})));}}export default App;","map":{"version":3,"sources":["/Users/angelinewang/SEI/Token-Based-Authenication-React-Express/token-based-auth/student/react-mastermind/src/pages/App/App.js"],"names":["React","Component","Route","Switch","GamePage","SettingsPage","HighScoresPage","SignupPage","LoginPage","scoresService","colors","Easy","Moderate","Difficult","App","constructor","isHighScore","guessesCopy","lastScore","state","scores","length","numGuesses","elapsedTime","seconds","handleTimerUpdate","setState","curState","handleDifficultyChange","level","difficulty","handleNewGameClick","handleColorSelection","colorIdx","selColorIdx","getInitialState","handlePegClick","pegIdx","currentGuessIdx","guesses","guessCopy","codeCopy","code","handleScoreClick","guessCodeCopy","secretCodeCopy","perfect","almost","forEach","idx","foundIdx","indexOf","scoreCopy","score","isTiming","initials","prompt","substr","create","props","history","push","getNewGuess","handleUpdateScores","genCode","numColors","Array","fill","map","dummy","Math","floor","random","getWinTries","lastGuess","componentDidMount","index","render","winTries"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport './App.css';\nimport { Route, Switch } from 'react-router-dom';\nimport GamePage from '../../pages/GamePage/GamePage';\nimport SettingsPage from '../SettingsPage/SettingsPage';\nimport HighScoresPage from '../HighScoresPage/HighScoresPage';\nimport SignupPage from '../SignupPage/SignupPage';\nimport LoginPage from '../LoginPage/LoginPage';\nimport scoresService from '../../utils/scoresService';\n\nconst colors = {\n  Easy: ['#7CCCE5', '#FDE47F', '#E04644', '#B576AD'],\n  Moderate: ['#7CCCE5', '#FDE47F', '#E04644', '#B576AD', '#B7D968'],\n  Difficult: ['#7CCCE5', '#FDE47F', '#E04644', '#B576AD', '#B7D968', '#555E7B']\n};\n\nclass App extends Component {\n  constructor() {\n    super();\n    this.state = {...this.getInitialState(), difficulty: 'Easy', scores: []};\n  }\n\n  getInitialState() {\n    return {\n      selColorIdx: 0,\n      guesses: [this.getNewGuess()],\n      code: this.genCode(),\n      elapsedTime: 0,\n      isTiming: true\n    };\n  }\n\n  getNewGuess() {\n    return {\n      code: [null, null, null, null],\n      score: {\n        perfect: 0,\n        almost: 0\n      }\n    };\n  }\n\n  genCode() {\n    let numColors = this.state && colors[this.state.difficulty].length;\n    numColors = numColors || 4;\n    return new Array(4).fill().map(dummy => Math.floor(Math.random() * numColors));\n  }\n\n  getWinTries() {\n    // if winner, return num guesses, otherwise 0 (no winner)\n    let lastGuess = this.state.guesses.length - 1;\n    return this.state.guesses[lastGuess].score.perfect === 4 ? lastGuess + 1 : 0;\n  }\n\n  isHighScore = (guessesCopy) => {\n    let lastScore = this.state.scores[this.state.scores.length - 1];\n    return (guessesCopy.length < lastScore.numGuesses || (\n      guessesCopy.length === lastScore.numGuesses &&\n      this.state.elapsedTime < lastScore.seconds\n    ));\n  }\n\n  /*--- Callback Methods ---*/\n\n  handleTimerUpdate = () => {\n    this.setState((curState) => ({elapsedTime: ++curState.elapsedTime}));\n  }\n\n  handleDifficultyChange = (level) => {\n    // Use callback to ensure level is updated BEFORE calling handleNewGameClick\n    this.setState({difficulty: level}, () => this.handleNewGameClick());\n  }\n  \n  handleColorSelection = (colorIdx) => {\n    this.setState({selColorIdx: colorIdx});\n  }\n\n  handleNewGameClick = () => {\n    this.setState(this.getInitialState());\n  }\n\n  handlePegClick = (pegIdx) => {\n    // Get index of last guess object\n    let currentGuessIdx = this.state.guesses.length - 1;\n\n    // Always replace objects/arrays with NEW ones\n    let guessesCopy = [...this.state.guesses];\n    let guessCopy = {...guessesCopy[currentGuessIdx]};\n    let codeCopy = [...guessCopy.code];\n\n    // Update the NEW code array with the currently selected color\n    codeCopy[pegIdx] = this.state.selColorIdx;\n\n    // Update the NEW guess object\n    guessCopy.code = codeCopy;\n\n    // Update the NEW guesses array\n    guessesCopy[currentGuessIdx] = guessCopy;\n\n    // Update state with the NEW guesses array\n    this.setState({\n        guesses: guessesCopy\n    });\n  }\n\n  handleScoreClick = () => {\n    // Need the index of the current guess object (last object in guesses array)\n    let currentGuessIdx = this.state.guesses.length - 1;\n\n    // Create \"working\" copies of the \"guessed\" code and the secret\n    // code so that we can modify them as we compute the number of\n    // perfect and almost without messing up the actual ones in state\n    let guessCodeCopy = [...this.state.guesses[currentGuessIdx].code];\n    let secretCodeCopy = [...this.state.code];\n\n    let perfect = 0, almost = 0;\n\n    // First pass computes number of \"perfect\"\n    guessCodeCopy.forEach((code, idx) => {\n      if (secretCodeCopy[idx] === code) {\n        perfect++;\n        // Ensure same choice is not matched again\n        // by updating both elements in the \"working\"\n        // arrays to null\n        guessCodeCopy[idx] = secretCodeCopy[idx] = null;\n      }\n    });\n\n    // Second pass computes number of \"almost\"\n    guessCodeCopy.forEach((code, idx) => {\n      if (code === null) return;\n      let foundIdx = secretCodeCopy.indexOf(code);\n      if (foundIdx > -1) {\n        almost++;\n        // Again, ensure same choice is not matched again\n        secretCodeCopy[foundIdx] = null;\n      }\n    });\n\n    // State must only be updated with NEW objects/arrays\n        // Always replace objects/arrays with NEW ones\n    let guessesCopy = [...this.state.guesses];\n    let guessCopy = {...guessesCopy[currentGuessIdx]};\n    let scoreCopy = {...guessCopy.score};\n\n    scoreCopy.perfect = perfect;\n    scoreCopy.almost = almost;\n    guessCopy.score = scoreCopy;\n    guessesCopy[currentGuessIdx] = guessCopy;\n\n    if (perfect === 4) {\n      // Chicken dinner - need to stop the timer!\n      this.setState(state => ({isTiming: false}), async function() {\n        // Do high-score logic in this callback\n        if ((this.state.scores.length < 20 || this.isHighScore(guessesCopy))) {\n          let initials = prompt('Congrats you have a top-20 score! Enter your initials: ').substr(0, 3);\n          await scoresService.create({ initials, numGuesses: guessesCopy.length, seconds: this.state.elapsedTime });\n          this.props.history.push('/high-scores');\n        }        \n      });\n    } else {\n      guessesCopy.push(this.getNewGuess());\n    }\n\n    this.setState({\n      guesses: guessesCopy,\n      // This is a great way to update isTiming\n      isTiming: perfect !== 4\n    });\n  }\n\n  handleUpdateScores = (scores) => {\n    this.setState({ scores });\n  }\n\n  /*--- Lifecycle Methods ---*/\n\n  async componentDidMount() {\n    const scores = await scoresService.index();\n    this.setState({ scores });\n  }\n\n  render() {\n    let winTries = this.getWinTries();\n    return (\n      <div>\n        <header className='header-footer'>R E A C T &nbsp;&nbsp;&nbsp;  M A S T E R M I N D</header>\n        <Switch>\n          <Route exact path='/' render={() =>\n            <GamePage\n              winTries={winTries}\n              colors={colors[this.state.difficulty]}\n              selColorIdx={this.state.selColorIdx}\n              guesses={this.state.guesses}\n              elapsedTime={this.state.elapsedTime}\n              isTiming={this.state.isTiming}\n              handleColorSelection={this.handleColorSelection}\n              handleNewGameClick={this.handleNewGameClick}\n              handlePegClick={this.handlePegClick}\n              handleScoreClick={this.handleScoreClick}\n              handleTimerUpdate={this.handleTimerUpdate}\n            />\n          }/>\n          <Route exact path='/settings' render={props => \n            <SettingsPage\n              {...props} \n              colorsLookup={colors}\n              difficulty={this.state.difficulty}\n              handleDifficultyChange={this.handleDifficultyChange}\n            />\n          }/>\n          <Route exact path='/signup' render={({ history }) => \n            <SignupPage\n              history={history}\n              \n            />\n          }/>\n          <Route exact path='/login' render={() => \n            <LoginPage\n              \n            />\n          }/>\n          <Route exact path='/high-scores' render={() => \n            <HighScoresPage\n              scores={this.state.scores}\n              handleUpdateScores={this.handleUpdateScores}\n            />\n          }/>\n        </Switch>\n      </div>\n    );\n  }\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}